<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>古代印度与异族入侵历史地图</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #8b4513;
            text-align: center;
            margin-bottom: 30px;
            font-family: 'SimSun', serif;
        }
        .map-section {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            padding: 20px;
        }
        h2 {
            color: #8b4513;
            margin-top: 0;
            border-bottom: 2px solid #d2b48c;
            padding-bottom: 10px;
            font-family: 'SimSun', serif;
        }
        #static-map-container {
            text-align: center;
        }
        #static-map {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #interactive-map {
            height: 600px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .map-legend {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .map-legend h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .legend-marker {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #8b4513;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            margin-right: 10px;
        }
        .legend-invasion {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #dc143c;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            margin-right: 10px;
        }
        .legend-kingdom {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #228b22;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            margin-right: 10px;
        }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        button {
            background-color: #8b4513;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #a0522d;
        }
        .map-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .map-info h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .map-info ul {
            margin: 0;
            padding-left: 20px;
        }
        .map-info li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>古代印度与异族入侵历史地图</h1>

        <!-- 静态地图部分 -->
        <div class="map-section">
            <h2>古代印度与异族入侵地图</h2>
            <div id="static-map-container">
                <img id="static-map" src="./doc/India.jpeg" alt="古代印度与异族入侵地图">
            </div>
            <div class="controls">
                <button onclick="saveImage()">保存图片</button>
                <button onclick="viewFullscreen()">全屏查看</button>
            </div>
        </div>

        <!-- 交互式地图部分 -->
        <div class="map-section">
            <h2>古代印度与异族入侵交互式地图</h2>
            <div id="interactive-map"></div>
            <div class="controls">
                <button onclick="zoomIn()">放大</button>
                <button onclick="zoomOut()">缩小</button>
                <button onclick="centerMap()">居中</button>
                <button onclick="changeMapType()">切换地图类型</button>
                <button onclick="showHistoricalSites()">显示历史遗迹</button>
                <button onclick="showInvasions()">显示入侵路线</button>
                <button onclick="showKingdoms()">显示古代王国</button>
            </div>
            <div id="map-legend" class="map-legend">
                <h3>地图图例</h3>
                <div class="legend-item">
                    <div class="legend-marker"></div>
                    <span>古代城市与遗迹</span>
                </div>
                <div class="legend-item">
                    <div class="legend-invasion"></div>
                    <span>异族入侵事件</span>
                </div>
                <div class="legend-item">
                    <div class="legend-kingdom"></div>
                    <span>古代印度王国</span>
                </div>
            </div>
            <div class="map-info">
                <h3>历史背景</h3>
                <ul>
                    <li>展示古代印度地理区域和重要历史事件</li>
                    <li>包含雅利安人、波斯人、希腊人、贵霜人、阿拉伯人等异族入侵</li>
                    <li>标注古代印度文明的重要城市和王国</li>
                    <li>使用腾讯地图JavaScript API</li>
                    <li>支持缩放、平移等交互操作</li>
                    <li>点击标记查看详细历史信息</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 引入腾讯地图JavaScript API -->
    <script charset="utf-8" src="https://map.qq.com/api/js?v=2.exp&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77"></script>
    <script>
        let map;
        let currentMapType = 1;
        const mapTypes = [
            qq.maps.MapTypeId.ROADMAP,  // 标准地图
            qq.maps.MapTypeId.SATELLITE, // 卫星图
            qq.maps.MapTypeId.HYBRID     // 混合图
        ];

        // 静态地图功能
        function saveImage() {
            const link = document.createElement('a');
            link.href = './doc/India.jpeg';
            link.download = 'Ancient_India_Invasions_map.jpeg';
            link.click();
        }

        function viewFullscreen() {
            const img = document.getElementById('static-map');
            if (img.requestFullscreen) {
                img.requestFullscreen();
            } else if (img.webkitRequestFullscreen) {
                img.webkitRequestFullscreen();
            } else if (img.msRequestFullscreen) {
                img.msRequestFullscreen();
            }
        }

        let historicalSites = [];
        let invasionEvents = [];
        let ancientKingdoms = [];

        // 初始化交互式地图
        function initMap() {
            const center = new qq.maps.LatLng(20.5937, 78.9629);
            const mapOptions = {
                zoom: 5,
                center: center,
                mapTypeId: qq.maps.MapTypeId.HYBRID
            };
            
            map = new qq.maps.Map(document.getElementById('interactive-map'), mapOptions);
            
            // 加载GeoJSON数据
            loadGeoJSONData();
        }

        // 加载GeoJSON数据函数
        function loadGeoJSONData() {
            fetch('./doc/ancient-india-history.geojson')
                .then(response => response.json())
                .then(data => {
                    // 处理GeoJSON数据
                    data.features.forEach(feature => {
                        const coordinates = feature.geometry.coordinates;
                        const properties = feature.properties;
                        
                        // 创建地图标记
                        const position = new qq.maps.LatLng(coordinates[1], coordinates[0]);
                        const marker = new qq.maps.Marker({
                            position: position,
                            map: map,
                            title: properties.name
                        });
                        
                        // 创建信息窗口
                        const infoWindow = new qq.maps.InfoWindow({
                            content: `<div style="padding: 10px;">
                                <strong>${properties.name}</strong><br>
                                ${properties.info}
                            </div>`,
                            map: map
                        });
                        
                        // 添加点击事件
                        qq.maps.event.addListener(marker, 'click', function() {
                            infoWindow.open();
                            infoWindow.setPosition(position);
                        });
                        
                        // 根据类型分类标记
                        switch(properties.type) {
                            case 'historical_site':
                                historicalSites.push(marker);
                                break;
                            case 'invasion':
                                invasionEvents.push(marker);
                                break;
                            case 'kingdom':
                                ancientKingdoms.push(marker);
                                break;
                        }
                    });
                })
        }

        // 地图控制功能
        function zoomIn() {
            map.setZoom(map.getZoom() + 1);
        }

        function zoomOut() {
            map.setZoom(map.getZoom() - 1);
        }

        function centerMap() {
            map.setCenter(new qq.maps.LatLng(20.5937, 78.9629));
        }

        function changeMapType() {
            currentMapType = (currentMapType + 1) % mapTypes.length;
            map.setMapTypeId(mapTypes[currentMapType]);
        }

        function addMarker() {
            const center = map.getCenter();
            const marker = new qq.maps.Marker({
                position: center,
                map: map
            });
        }

        function showHistoricalSites() {
            historicalSites.forEach(marker => {
                marker.setMap(map);
            });
        }

        function hideHistoricalSites() {
            historicalSites.forEach(marker => {
                marker.setMap(null);
            });
        }

        function showInvasions() {
            invasionEvents.forEach(marker => {
                marker.setMap(map);
            });
        }

        function hideInvasions() {
            invasionEvents.forEach(marker => {
                marker.setMap(null);
            });
        }

        function showKingdoms() {
            ancientKingdoms.forEach(marker => {
                marker.setMap(map);
            });
        }

        function hideKingdoms() {
            ancientKingdoms.forEach(marker => {
                marker.setMap(null);
            });
        }

        // 页面加载完成后初始化地图
        window.onload = function() {
            initMap();
        };
    </script>
</body>
</html>